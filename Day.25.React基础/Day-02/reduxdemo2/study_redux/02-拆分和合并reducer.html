<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./js/redux.js"></script>
</head>

<body>
    <script>
        // 1.贮备初始状态
        let initState = {
            todo: [
                { text: "学习react", done: false },
                { text: "打游戏", done: true },
                { text: "睡觉", done: false }
            ],
            visibility: "all"
        }
        // 2.准备actions creator就是根据传参创建对应的action使action中死数据变为活数据
        function addTodo(text) {
            // 返回一个action
            return {
                type: "ADD_TODO",
                text
            }
        }
        function toggleTodo(todo) {
            // 返回一个action
            return {
                type: "TOGGLE_TODO",
                todo
            }
        }
        function setVisibility(flag) {
            // 返回一个action
            return {
                type: "SET_VISIBILITY",
                flag
            }
        }

        // 3.定义todo的管理
        function reducerTodo(state = [], action) {
            switch (action.type) {
                case "ADD_TODO":
                    return [...state, { text: action.text, done: false }]
                case "TOGGLE_TODO":
                    var todo = state.map(todo => {
                        if (todo == action.todo) {
                            // 找到todo  改变状态
                            return Object.assign({}, todo, { done: !todo.done })
                        }
                        return todo
                    })
                default:
                    return state
            }
        }
        // 定义visibility的管理
        function reducerVisi(state = "all", actions) {
            switch (actions) {
                case "SET_VISIBILITY":
                    return { visibility: action.flag }
                default:
                    return state
            }
        }       
        
        // 合并reducer
/*         function reducer(state = initState, action) {
            return {
                // 将管理的方法进行合并
                todo: reducerTodo(state.todo, action),
                visibility: reducerVisi(state.visibility, action)
            }
        } */
        // 使用封装函数进行合并
        let reducer = Redux.combineReducers({
            // 注意前面是合并的初始状态名称，后面是操作方法
            todo:reducerTodo,
            visibility:reducerVisi
         })


        // 4.创建仓库store ，使用的是合并之后的reducer
        let store = Redux.createStore(reducer)

        // 5.订阅跟踪状态的改变 subscribe
        store.subscribe((data) => {
            console.log(data)
            console.log(store.getState())
        })

        // 修改状态
        store.dispatch(addTodo("没有过的"))
        store.dispatch(addTodo("没有过的1"))
        store.dispatch(toggleTodo(store.getState().todo[4]))
        store.dispatch(setVisibility("???"))
        // store.dispatch(addTodo("没有过的"))

    </script>
</body>

</html>